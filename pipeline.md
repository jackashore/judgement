# Набросок пайплайна!

## Стадия 1. Препроцессинг

1. xml-файл разбивается на 3 части: от начала до "Установил", от "Установил" до "Приговорил" (основная часть), от "Приговорил" до конца
2. Из 1 и 3 частей извлекаются метаданные (судья, подсудимый, срок, статья и проч.)
3. Для второй части происходит минимальная нормализация: замена цифр, названий кодексов и так далее (это всё есть в функции, которую я написала)
3. Для второй части происходит "запикивание" юридизмов, список которых определён заранее (здесь у меня вопросы: возможно стоит это сделать потом)

## Стадия 2. Деление на абзацы

???

(если с эмбеддингами предложений ничего не выйдет, можно просто поделить на абзацы, которые есть в разметке xml, и посмотреть, как это работает)

В идеале хорошо бы разбить на осмысленные абзацы с названиями типа фабула, свидетельские показания и т.д., чтобы в дальнейшем сформировать отдельные поля для базы (см. ниже), но, возможно, это мои розовые мечты

## Стадия 3. Оформление в базу эластиксёрч

Пример описания документа из лекции про эластиксёрч:

```
mapit={"article":{"properties":{"author":{"type":"text"},
                                "date":{"type":"text"},
                                "time":{"type":"date", "format":"HH:mm"},
                                "difficulty":{"type":"double"},
                                "rubrics":{"type":"text","analyzer" : "russian"},
                                "text":{"type":"text","analyzer" : "russian"},
                                "title":{"type":"text","analyzer" : "russian"}}}}
```

Подробнее можно посмотреть [тут](https://colab.research.google.com/drive/1T-GszTIGBN10MiCkwXOOsWW2st5a6bcC#scrollTo=Gw6AP6toLDtF) (тетрадка авторства Эдуарда Станиславовича Клышинского)

Как мы понимаем, нам нужны поля для метаданных, и было бы круто сделать также отдельные поля для отдельных абзацев (о чём говорилось выше) вместо того, чтобы складывать весь текст в поле `text`

Важно, что эластиксёрч сам делает нормализацию документов, поэтому нам не нужно применять пайморфи и прочие _эти_наши_ майстемы, но здесь у меня снова встают некоторые неразрешённые вопросы, которые я проясню в ближайшее время и обновлю этот документ

## Стадия 4. Поиск копипасты

Здесь нам бы очень сильно пригодились поля типа `fabula`, `witness` и так далее, в которых лежали бы соответствующие абзацы документа. Это всё затем, что нам нужно сравнивать фабулы с фабулами, а медитации с медитациями. Делаем поисковый запрос, в который загоняем всю фабулу данного документа, и производим поиск только по фабулам в данном суде, очень удобно, согласитесь. Надо отметить, что эластиксёрч обладает функцией нечёткого поиска (как в гугле), поэтому скорее всего при поиске целого абзаца мы найдём что-то весьма похожее на такой абзац (но не на сто процентов совпадающее). Также при первых итерациях поиска мы посмотрим глазами на то, что получилось, и если **вдруг** там встретились юридизмы, которые мы не убрали, добавим их к массиву юридизмов.

Мой первый, не судите строго!
